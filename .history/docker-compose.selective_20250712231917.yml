version: "3.8"

services:
  # ChromaDB ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ (ìš°ì„  ì‹œì‘)
  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb-server
    ports:
      - "8001:8000"
    environment:
      - CHROMA_SERVER_HOST=0.0.0.0
      - CHROMA_SERVER_HTTP_PORT=8000
    volumes:
      # ğŸ”’ í˜¸ìŠ¤íŠ¸ ê²½ë¡œì— ì§ì ‘ ë°”ì¸ë”© (ë°ì´í„° ì•ˆì „ì„±)
      - ./data/chroma:/data
      # ê°œë°œ í™˜ê²½ìš© ë°±ì—… ë””ë ‰í† ë¦¬
      - ./backups/chroma:/backups
    restart: unless-stopped
    networks:
      - mcp-network

  # FastMCP ì„œë²„ (ChromaDB ì¤€ë¹„ í›„ ì‹œì‘)
  fastmcp-server:
    build: .
    container_name: fastmcp-prompt-enhancement
    ports:
      - "8000:8000" # SSE ëª¨ë“œë¥¼ ìœ„í•œ í¬íŠ¸ ë…¸ì¶œ
    environment:
      # ğŸ” OpenAI API ì„¤ì •
      - OPENAI_API_KEY=${OPENAI_API_KEY}

      # ğŸ“Š ChromaDB ì—°ê²° ì„¤ì •
      - CHROMA_HOST=chromadb
      - CHROMA_PORT=8000
      - CHROMA_DB_PATH=/data

      # ğŸ“ ë¡œê¹… ì„¤ì •
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - LOG_DIR=/data/logs

      # ğŸš€ MCP ì„¤ì •
      - MCP_SERVER_NAME=FastMCP Prompt Enhancement Server
      - MCP_VERSION=2.0.0

      # ğŸ§  AI ì„¤ì •
      - MAX_CONTEXT_LENGTH=${MAX_CONTEXT_LENGTH:-5}
      - SIMILARITY_THRESHOLD=${SIMILARITY_THRESHOLD:-0.7}

      # ğŸ“ˆ ë¶„ì„ ì„¤ì •
      - ENABLE_ADVANCED_ANALYTICS=${ENABLE_ADVANCED_ANALYTICS:-true}
      - CLUSTERING_ALGORITHM=${CLUSTERING_ALGORITHM:-kmeans}
      - MAX_CLUSTERS=${MAX_CLUSTERS:-10}
    volumes:
      # ğŸ—‚ï¸ ë¡œê·¸ ë° ë°ì´í„° ì €ì¥ì„ ìœ„í•œ ë³¼ë¥¨ ë§ˆìš´íŠ¸
      - ./data:/data

      # ğŸ¯ ì„ íƒì  í”„ë¡œì íŠ¸ ë§ˆìš´íŠ¸ ì„¹ì…˜
      # ğŸ‘‡ ì›í•˜ëŠ” í”„ë¡œì íŠ¸ë§Œ ì£¼ì„ì„ í•´ì œí•˜ì—¬ í™œì„±í™”í•˜ì„¸ìš”

      # í˜„ì¬ MCP ì„œë²„ í”„ë¡œì íŠ¸ (ì˜ˆì‹œë¡œ í™œì„±í™”ë¨)
      - /Users/soobeen/Desktop/Project/mcp-server:/host_projects/mcp-server:ro

      # ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë“¤ (í•„ìš”í•œ ê²ƒë§Œ ì£¼ì„ í•´ì œ)
      # - /Users/soobeen/Desktop/Project/my-web-app:/host_projects/my-web-app:ro
      # - /Users/soobeen/Desktop/Project/api-backend:/host_projects/api-backend:ro
      # - /Users/soobeen/Desktop/Project/mobile-app:/host_projects/mobile-app:ro
      # - /Users/soobeen/Desktop/Project/data-analysis:/host_projects/data-analysis:ro
      # - /Users/soobeen/Desktop/Project/machine-learning:/host_projects/machine-learning:ro
      # - /Users/soobeen/Desktop/Project/frontend-components:/host_projects/frontend-components:ro
      # - /Users/soobeen/Desktop/Project/microservice-auth:/host_projects/microservice-auth:ro
      # - /Users/soobeen/Desktop/Project/react-dashboard:/host_projects/react-dashboard:ro
      # - /Users/soobeen/Desktop/Project/python-scripts:/host_projects/python-scripts:ro
      # - /Users/soobeen/Desktop/Project/vue-portfolio:/host_projects/vue-portfolio:ro

      # ğŸ’¡ ë” ë§ì€ í”„ë¡œì íŠ¸ë¥¼ ì¶”ê°€í•˜ë ¤ë©´:
      # - /ê²½ë¡œ/to/your/project:/host_projects/project-name:ro

    restart: unless-stopped
    depends_on:
      - chromadb
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge
# ğŸš€ ì‚¬ìš© ë°©ë²•:
# 1. ì›í•˜ëŠ” í”„ë¡œì íŠ¸ ë¼ì¸ì˜ ì£¼ì„(#)ì„ ì œê±°
# 2. í”„ë¡œì íŠ¸ ê²½ë¡œë¥¼ ì‹¤ì œ ê²½ë¡œë¡œ ìˆ˜ì •
# 3. docker-compose -f docker-compose.selective.yml up -d ë¡œ ì‹¤í–‰
