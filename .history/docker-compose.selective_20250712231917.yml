version: "3.8"

services:
  # ChromaDB 벡터 데이터베이스 서비스 (우선 시작)
  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb-server
    ports:
      - "8001:8000"
    environment:
      - CHROMA_SERVER_HOST=0.0.0.0
      - CHROMA_SERVER_HTTP_PORT=8000
    volumes:
      # 🔒 호스트 경로에 직접 바인딩 (데이터 안전성)
      - ./data/chroma:/data
      # 개발 환경용 백업 디렉토리
      - ./backups/chroma:/backups
    restart: unless-stopped
    networks:
      - mcp-network

  # FastMCP 서버 (ChromaDB 준비 후 시작)
  fastmcp-server:
    build: .
    container_name: fastmcp-prompt-enhancement
    ports:
      - "8000:8000" # SSE 모드를 위한 포트 노출
    environment:
      # 🔐 OpenAI API 설정
      - OPENAI_API_KEY=${OPENAI_API_KEY}

      # 📊 ChromaDB 연결 설정
      - CHROMA_HOST=chromadb
      - CHROMA_PORT=8000
      - CHROMA_DB_PATH=/data

      # 📝 로깅 설정
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - LOG_DIR=/data/logs

      # 🚀 MCP 설정
      - MCP_SERVER_NAME=FastMCP Prompt Enhancement Server
      - MCP_VERSION=2.0.0

      # 🧠 AI 설정
      - MAX_CONTEXT_LENGTH=${MAX_CONTEXT_LENGTH:-5}
      - SIMILARITY_THRESHOLD=${SIMILARITY_THRESHOLD:-0.7}

      # 📈 분석 설정
      - ENABLE_ADVANCED_ANALYTICS=${ENABLE_ADVANCED_ANALYTICS:-true}
      - CLUSTERING_ALGORITHM=${CLUSTERING_ALGORITHM:-kmeans}
      - MAX_CLUSTERS=${MAX_CLUSTERS:-10}
    volumes:
      # 🗂️ 로그 및 데이터 저장을 위한 볼륨 마운트
      - ./data:/data

      # 🎯 선택적 프로젝트 마운트 섹션
      # 👇 원하는 프로젝트만 주석을 해제하여 활성화하세요

      # 현재 MCP 서버 프로젝트 (예시로 활성화됨)
      - /Users/soobeen/Desktop/Project/mcp-server:/host_projects/mcp-server:ro

      # 다른 프로젝트들 (필요한 것만 주석 해제)
      # - /Users/soobeen/Desktop/Project/my-web-app:/host_projects/my-web-app:ro
      # - /Users/soobeen/Desktop/Project/api-backend:/host_projects/api-backend:ro
      # - /Users/soobeen/Desktop/Project/mobile-app:/host_projects/mobile-app:ro
      # - /Users/soobeen/Desktop/Project/data-analysis:/host_projects/data-analysis:ro
      # - /Users/soobeen/Desktop/Project/machine-learning:/host_projects/machine-learning:ro
      # - /Users/soobeen/Desktop/Project/frontend-components:/host_projects/frontend-components:ro
      # - /Users/soobeen/Desktop/Project/microservice-auth:/host_projects/microservice-auth:ro
      # - /Users/soobeen/Desktop/Project/react-dashboard:/host_projects/react-dashboard:ro
      # - /Users/soobeen/Desktop/Project/python-scripts:/host_projects/python-scripts:ro
      # - /Users/soobeen/Desktop/Project/vue-portfolio:/host_projects/vue-portfolio:ro

      # 💡 더 많은 프로젝트를 추가하려면:
      # - /경로/to/your/project:/host_projects/project-name:ro

    restart: unless-stopped
    depends_on:
      - chromadb
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge
# 🚀 사용 방법:
# 1. 원하는 프로젝트 라인의 주석(#)을 제거
# 2. 프로젝트 경로를 실제 경로로 수정
# 3. docker-compose -f docker-compose.selective.yml up -d 로 실행
